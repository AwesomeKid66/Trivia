<div id="topics"></div>
<div id="question-container" style="display:none;">
  <p id="question-text"></p>
  <button id="reveal-answer">Reveal Answer</button>
  <p id="answer-text" style="visibility:hidden; margin:0;"></p>
  <button id="next-question">Next Question</button>
</div>

<script>
let questions = [];
let currentIndex = 0;

// Load topics
async function loadTopics() {
  const res = await fetch("/topics/");
  const topics = await res.json();
  const container = document.getElementById("topics");
  container.innerHTML = "<h2>Select a topic:</h2>";
  topics.forEach(topic => {
    const btn = document.createElement("button");
    btn.textContent = topic;
    btn.onclick = () => startTopic(topic);
    container.appendChild(btn);
  });
}

// Fisher-Yates shuffle
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// Start a topic
async function startTopic(topic) {
  const res = await fetch(`/questions/${encodeURIComponent(topic)}/`);
  const rawQuestions = await res.json();

  // Group by likelihood
  const grouped = {};
  rawQuestions.forEach(q => {
    if (!grouped[q.likelihood]) grouped[q.likelihood] = [];
    grouped[q.likelihood].push(q);
  });

  // Sort by likelihood descending, shuffle each group, then flatten
  questions = [];
  [5,4,3,2,1].forEach(level => {
    if (grouped[level]) {
      questions = questions.concat(shuffle(grouped[level]));
    }
  });

  currentIndex = 0;
  document.getElementById("topics").style.display = "none";
  document.getElementById("question-container").style.display = "block";
  showQuestion();
}

function showQuestion() {
  if (currentIndex >= questions.length) {
    alert("No more questions!");
    document.getElementById("topics").style.display = "block";
    document.getElementById("question-container").style.display = "none";
    return;
  }
  const q = questions[currentIndex];
  document.getElementById("question-text").textContent = q.question;
  document.getElementById("answer-text").textContent = q.answer;

  // hide answer at start
  document.getElementById("answer-text").style.visibility = "hidden";
}

// Reveal answer button
document.getElementById("reveal-answer").onclick = () => {
  document.getElementById("answer-text").style.visibility = "visible";
};

// Next question button
document.getElementById("next-question").onclick = () => {
  currentIndex++;
  showQuestion();
};


loadTopics();
</script>
