{% extends "base.html" %}

{% block title %}Study Home Â· {{ user_name }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <div class="card-title">
            Study home for {{ user_name }}
            <span class="card-title-pill">Dashboard</span>
        </div>
        <div class="card-subtitle">
            This is your personal hub. Jump back into a topic, focus on missed questions,
            or reset parts of your progress.
        </div>
        <div class="pill-row">
            <span class="pill">
                <a href="{{ url_for('stats', user_name=user_name) }}" style="color: inherit; text-decoration: none;">
                    ðŸ“Š View full stats
                </a>
            </span>
            <span class="pill">
                <a href="{{ url_for('index') }}" style="color: inherit; text-decoration: none;">
                    ðŸ“š Back to topics
                </a>
            </span>
        </div>
    </div>

    <div class="card-body">
        {% if not overall %}
            <p class="muted">
                No progress recorded yet for <strong>{{ user_name }}</strong>.
                Choose a topic and start a study session!
            </p>
        {% else %}
            <div class="stack">
                <div class="stack-h">
                    <div class="stack-sm" style="flex: 1;">
                        <div class="badge-soft">Total tracked</div>
                        <div style="font-size: 1.4rem; font-weight: 600;">
                            {{ overall.total }}
                        </div>
                        <div class="muted">Questions youâ€™ve interacted with</div>
                    </div>
                    <div class="stack-sm" style="flex: 1;">
                        <div class="badge-soft">Completion</div>
                        <div style="font-size: 1.4rem; font-weight: 600;">
                            {{ overall.completion|round(1) }}%
                        </div>
                        <div class="muted">Correct / total</div>
                    </div>
                    <div class="stack-sm" style="flex: 1;">
                        <div class="badge-soft">Correct</div>
                        <div style="font-size: 1.4rem; font-weight: 600; color: #4ade80;">
                            {{ overall.correct }}
                        </div>
                        <div class="muted">Marked as mastered</div>
                    </div>
                    <div class="stack-sm" style="flex: 1;">
                        <div class="badge-soft">Wrong / in progress</div>
                        <div style="font-size: 1.4rem; font-weight: 600; color: #f97373;">
                            {{ overall.wrong }}
                        </div>
                        <div class="muted">Still being worked on</div>
                    </div>
                </div>

                <form method="post"
                      action="{{ url_for('reset_progress_user', user_name=user_name) }}"
                      onsubmit="return confirm('Reset ALL progress for {{ user_name }}?');">
                    <button type="submit" class="btn btn-danger btn-sm" style="margin-top: 0.75rem;">
                        ðŸ”„ Reset ALL progress for {{ user_name }}
                    </button>
                </form>

                <div class="stack-sm">
                    <div class="badge-soft">Topics youâ€™ve worked on</div>
                    {% if topic_rows %}
                        <div class="stack">
                            {% for row in topic_rows %}
                                {% set done = row.correct %}
                                {% set total = row.total %}
                                {% set pct = (done / total * 100) if total else 0 %}
                                <div style="border-radius: 0.9rem; border: 1px solid rgba(148,163,184,0.5); padding: 0.75rem 0.9rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 0.6rem;">
                                        <div>
                                            <div style="font-weight: 600;">{{ row.topic }}</div>
                                            <div class="muted">
                                                {{ done }} correct Â· {{ row.wrong }} wrong Â· {{ total }} total
                                            </div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 1.1rem; font-weight: 600;">
                                                {{ pct|round(1) }}%
                                            </div>
                                            <div class="muted">complete</div>
                                        </div>
                                    </div>
                                    <div class="stack-h" style="margin-top: 0.6rem;">
                                        <a href="{{ url_for('study', topic=row.topic) }}?user={{ user_name|urlencode }}&mode=all"
                                           class="btn btn-sm btn-outline">
                                            â–¶ Study all
                                        </a>
                                        <a href="{{ url_for('study', topic=row.topic) }}?user={{ user_name|urlencode }}&mode=missed"
                                           class="btn btn-sm btn-outline">
                                            â†º Study missed only
                                        </a>
                                        <form method="post"
                                              action="{{ url_for('reset_topic_progress', user_name=user_name, topic=row.topic) }}"
                                              onsubmit="return confirm('Reset progress for topic {{ row.topic }}?');">
                                            <button type="submit" class="btn btn-sm btn-danger">
                                                ðŸ§¹ Reset topic
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="muted">No topic-level history yet.</p>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

